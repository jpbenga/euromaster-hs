<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <?!= include('styles'); ?>
  <script>
    // Injection du token serveur vers le client JS
    var globalToken = "<?= initialToken ?>";
  </script>
</head>

<body>
  <div id="app-container">

    <div id="loading-view" class="view">
      <div class="login-card">
        <p>Authentification et vérification de l'état du système en cours...</p>
      </div>
    </div>

    <div id="login-view" class="view hidden">
      <div class="login-card">
        <img
          src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/25/Euromaster_logo.svg/1200px-Euromaster_logo.svg.png"
          alt="Euromaster Logo" class="logo">
        <h2>Portail Heures Supplémentaires</h2>
        <div id="login-error" class="error-message"></div>
      </div>
    </div>

    <div id="choice-view" class="view hidden">
      <div class="login-card">
        <img
          src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/25/Euromaster_logo.svg/1200px-Euromaster_logo.svg.png"
          alt="Euromaster Logo" class="logo">
        <h2>Bienvenue</h2>
        <p>Veuillez choisir votre action.</p>

        <button id="setup-button" class="btn-primary" onclick="showView('setup-view')" style="margin-bottom: 10px;">
          Créer un nouveau centre (Première Utilisation)
        </button>

        <button id="login-button" class="btn-secondary" onclick="tryLogin()">
          Se Connecter (Manager / Google)
        </button>
        <p style="font-size:0.8em; margin-top:10px; color:#666;">Note: Si vous êtes collaborateur, veuillez utiliser le
          lien reçu par email.</p>
        <div id="choice-error" class="error-message hidden"></div>
      </div>
    </div>

    <?!= include('setup'); ?>
    <?!= include('collaborator'); ?>
    <?!= include('manager'); ?>

  </div>

  <div id="notification-container"></div>

  <div id="rejection-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3>Motif du Rejet</h3>
      <form id="rejection-form">
        <input type="hidden" id="rejection-entry-id" name="entryId">
        <div class="form-group">
          <label for="rejection-reason">Veuillez expliquer clairement la raison du refus (Obligatoire)</label>
          <textarea id="rejection-reason" name="reason" rows="3" required></textarea>
        </div>
        <div style="display: flex; gap: 10px;">
          <button type="submit" class="btn-primary" id="rejection-submit-btn" style="width: 50%;">Confirmer le
            Rejet</button>
          <button type="button" class="btn-secondary" style="width: 50%;"
            onclick="hideRejectionModal()">Annuler</button>
        </div>
      </form>
    </div>
  </div>

  <?!= include('scripts_core'); ?>
  <?!= include('scripts_auth'); ?>
  <?!= include('scripts_collaborator'); ?>
  <?!= include('scripts_manager'); ?>

</body>

</html>